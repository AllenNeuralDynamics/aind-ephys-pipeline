process { 
    executor = 'awsbatch' 
    queueSize = 100
}

process.resourceLabels = ['allen-batch-pipeline': 'aind-ephys-pipeline']

process { 
  withName: capsule_aind_ephys_postprocessing_5 { containerOptions = '--shm-size 16000000' }
  withName: capsule_spikesort_spyking_circus_2_ecephys_7 { containerOptions = '--shm-size 16000000' }
  withName: capsule_spikesort_spyking_circus_2_ecephys_7 {
    errorStrategy = 'retry'
    maxRetries = 3
    maxErrors = 5
  }
  withName: capsule_quality_control_ecephys_14 {
    containerOptions = '--memory-swap 240000 --memory-swappiness 20 --shm-size 16000000'
  }
}

env.PIPELINE_URL = "https://github.com/AllenNeuralDynamics/aind-ephys-pipeline"
env.PIPELINE_VERSION = "spykingcircus2_0.2.0"